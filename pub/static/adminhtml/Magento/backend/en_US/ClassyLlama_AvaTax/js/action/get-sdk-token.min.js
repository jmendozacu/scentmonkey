define(['jquery'],function(jQuery){'use strict';var expirationBuffer=5*60*1000;var avaTaxTokenStorageKey='admin-avatax-token';var requiredInfo=['token','customer','client_id','expires','sdk_url'];function generateTokenResolve(tokenInfo){return jQuery.Deferred().resolve(tokenInfo.sdk_url,tokenInfo.token,tokenInfo.client_id);}
return function getSdkToken(tokenUrl,customerId){var tokenInfo=window.localStorage.getItem(avaTaxTokenStorageKey);if(tokenInfo===null){tokenInfo='{}';}
tokenInfo=JSON.parse(tokenInfo);if(tokenInfo===false){tokenInfo={};}
if(tokenInfo[customerId]!==void(0)&&tokenInfo[customerId].expires*1000>Date.now()+expirationBuffer){return generateTokenResolve(tokenInfo[customerId]);}
delete tokenInfo[customerId];return jQuery.ajax({url:tokenUrl,type:'post',data:{customer_id:customerId}}).then(function(response){if(!requiredInfo.every(function(key){return response.hasOwnProperty(key);})){return jQuery.Deferred().reject();}
tokenInfo[customerId]=response;window.localStorage.setItem(avaTaxTokenStorageKey,JSON.stringify(tokenInfo));return generateTokenResolve(tokenInfo[customerId]);});}});