define(['jquery','mage/storage','Magento_Customer/js/model/customer'],function(jQuery,storage,customerModel){'use strict';var expirationBuffer=5*60*1000;var avaTaxTokenStorageKey='avatax-token';var requiredInfo=['token','customer','client_id','expires','sdk_url'];return function getSdkToken(){var tokenInfo=window.localStorage.getItem(avaTaxTokenStorageKey);if(tokenInfo!==null){tokenInfo=JSON.parse(tokenInfo);if(!customerModel.isLoggedIn()||customerModel.customerData.id!==tokenInfo.customer_id){tokenInfo=false;}
if(tokenInfo!==false&&tokenInfo.expires*1000>Date.now()+expirationBuffer){return jQuery.Deferred().resolve(tokenInfo.sdk_url,tokenInfo.token,tokenInfo.client_id);}
window.localStorage.removeItem(avaTaxTokenStorageKey)}
return storage.get('rest/V1/avatax/token').then(function(response){if(!requiredInfo.every(function(key){return response.hasOwnProperty(key);})){return jQuery.Deferred().reject();}
window.localStorage.setItem(avaTaxTokenStorageKey,JSON.stringify(response));return jQuery.Deferred().resolve(response.sdk_url,response.token,response.customer,response.client_id);});}});