define(['jquery','mage/translate','Magento_Payment/js/view/payment/cc-form','Magento_Checkout/js/model/quote','Magento_Vault/js/view/payment/vault-enabler','TNW_AuthorizeCim/js/view/payment/validator-handler','Magento_Checkout/js/model/full-screen-loader'],function($,$t,Component,quote,VaultEnabler,validatorManager,fullScreenLoader){'use strict';return Component.extend({defaults:{template:'TNW_AuthorizeCim/payment/cc-form',ccCode:null,ccMessageContainer:null,validatorManager:validatorManager,code:'tnw_authorize_cim',additionalData:{},imports:{onActiveChange:'active'}},initialize:function(){this._super();this.vaultEnabler=new VaultEnabler();this.vaultEnabler.setPaymentCode(this.getVaultCode());return this;},initObservable:function(){this._super().observe(['active']);this.validatorManager.initialize();return this;},isActive:function(){var active=this.getCode()===this.isChecked();this.active(active);return active;},onActiveChange:function(isActive){if(!isActive){return;}
this.restoreMessageContainer();this.restoreCode();fullScreenLoader.startLoader();this.validatorManager.load(function(){fullScreenLoader.stopLoader();});},getSelector:function(field){return'#'+this.getCode()+'_'+field;},restoreMessageContainer:function(){this.messageContainer=this.ccMessageContainer;},restoreCode:function(){this.code=this.ccCode;},initChildren:function(){this._super();this.ccMessageContainer=this.messageContainer;this.ccCode=this.code;return this;},getCode:function(){return this.code;},getData:function(){var data=this._super();delete data['additional_data']['cc_cid'];delete data['additional_data']['cc_number'];data['additional_data']=_.extend(data['additional_data'],this.additionalData);this.vaultEnabler.visitAdditionalData(data);return data;},addAdditionalData:function(key,value){this.additionalData[key]=value;},isVaultEnabled:function(){return this.vaultEnabler.isVaultEnabled();},isButtonActive:function(){return this.isActive()&&this.isPlaceOrderActionAllowed();},validateCardType:function(){return this.selectedCardType()!==null;},placeOrderClick:function(){if(this.validateCardType()){this.placeOrder();}},getVaultCode:function(){return window.checkoutConfig.payment[this.getCode()].vaultCode;},placeOrder:function(key){var self=this;if(key){return self._super();}
self.isPlaceOrderActionAllowed(false);self.validatorManager.validate(self).done(function(){self.placeOrder('parent');}).fail(function(error){self.isPlaceOrderActionAllowed(true);self.messageContainer.addErrorMessage({message:error});});return false;}});});