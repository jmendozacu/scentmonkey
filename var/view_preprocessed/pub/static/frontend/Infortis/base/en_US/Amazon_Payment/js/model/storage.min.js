define(['jquery','ko','amazonCore','amazonPaymentConfig'],function($,ko,amazonCore,amazonPaymentConfig){'use strict';var isAmazonAccountLoggedIn=ko.observable(false),isAmazonEnabled=ko.observable(amazonPaymentConfig.getValue('isPwaEnabled')),orderReference,addressConsentToken=amazonCore.accessToken,amazonLoginError=amazonCore.amazonLoginError.subscribe(setAmazonLoggedOutIfLoginError),amazonDeclineCode=ko.observable(false),sandboxSimulationReference=ko.observable('default'),isPlaceOrderDisabled=ko.observable(false),isShippingMethodsLoading=ko.observable(false),isAmazonShippingAddressSelected=ko.observable(false),isQuoteDirty=ko.observable(amazonPaymentConfig.getValue('isQuoteDirty')),isPwaVisible=ko.computed(function(){return isAmazonEnabled()&&!isQuoteDirty();}),isAmazonCartInValid=ko.computed(function(){return isAmazonAccountLoggedIn()&&isQuoteDirty();}),isLoginRedirectPage=$('body').hasClass('amazon-login-login-processauthhash');function amazonLogOut(){amazonCore.AmazonLogout();this.isAmazonAccountLoggedIn(false);}
function setAmazonLoggedOutIfLoginError(isLoggedOut){if(isLoggedOut===true){isAmazonAccountLoggedIn(false);amazonLoginError.dispose();}}
isAmazonCartInValid.subscribe(function(isCartInValid){if(isCartInValid){amazonLogOut();}});verifyAmazonLoggedIn();setAmazonLoggedOutIfLoginError(amazonCore.amazonLoginError());function verifyAmazonLoggedIn(){isAmazonAccountLoggedIn(!!amazonCore.accessToken());}
return{isAmazonAccountLoggedIn:isAmazonAccountLoggedIn,isAmazonEnabled:isAmazonEnabled,amazonDeclineCode:amazonDeclineCode,sandboxSimulationReference:sandboxSimulationReference,isPlaceOrderDisabled:isPlaceOrderDisabled,isShippingMethodsLoading:isShippingMethodsLoading,isAmazonShippingAddressSelected:isAmazonShippingAddressSelected,isQuoteDirty:isQuoteDirty,isPwaVisible:isPwaVisible,amazonlogOut:amazonLogOut,amazonDefined:amazonCore.amazonDefined,setOrderReference:function(or){orderReference=or;},getOrderReference:function(){return orderReference;},getAddressConsentToken:function(){return addressConsentToken();}};});